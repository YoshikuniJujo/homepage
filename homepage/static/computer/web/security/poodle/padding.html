POODLE: パディング部を利用した攻撃

<h2>攻撃対象</h2>

<p>
CBCモードでパディング部の正しさをチェックしていないサーバ。
SSLv3のCBCモードを利用しているか、
またはTLSであっても不適切な実装を使用しているサーバ。
</p>

<h2>攻撃方法の要約</h2>

<h3>前提</h3>

<p>
SSL/TLSで使用されているパディングの方式では、
CBC暗号の最後のブロックは必ずパディングを含むことになっていて、
そのブロックの最後の1バイトがパディング長を示す。
もともとのデータがブロック長の整数倍である場合、
パディングは不要のように思われるが、
実際にはそうではなく、パディングのみのブロックが必要になる。
この攻撃はそのような場合において可能となる。
</p>

<h3>実際の攻撃</h3>

<p>
攻撃者が入手した暗号文の任意のブロックをパディング部にコピーし、
サーバに送信する。
だいたいにおいてパディング長を示す最後のバイトが異なるのでエラーとなる。
しかし、256分の1の確率でエラーとならない場合がある。
パディング長は既知なので、復号化されたブロックの最後のバイトがわかることになる。
するとCBCモードの特徴から、暗号化される直前のブロックの最後のバイトがわかる。
つまり、パディング部にコピーしたもとのブロックの最後のバイトがわかることになる。
</p>

<p>
この攻撃は1バイト判定するのに期待値的に256回の試行が必要になる。
これを1バイトずつずらしたデータでくりかえすことで、
必要なだけのデータを取得することができる。
</p>

<h2>実装における対策</h2>

<p>
パディング部のデータを決めておき、サーバがきちんとチェックすれば良い。
TLSではパディング部のデータは
全てのバイトがパディング長を示す値になっている必要がある。
</p>

<h2>攻撃に使われる計算の詳細</h2>

<p>
この攻撃について理解するためには
ブロック暗号のCBCモードについての理解が必要になる。
<a href="http://ja.wikipedia.org/wiki/暗号利用モード#Cipher-Block_Chaining_.28CBC.29"
>wikipediaの記事</a>か何かを読むと良いかもしれない。
</p>

<p>
パディング部にコピーした暗号文の復号結果の最後の1バイトは
パディング長を示す値になる(そうでないとエラーとなるので)。
パディング部のひとつ前の暗号文の最後の1バイトとのXORをとることで、
パディング部にコピーした暗号文のAESによる暗号化直前の値がわかる。
それとコピーもとの暗号ブロックのひとつ手前の暗号文の最後の1バイトとの
XORをとることで、コビーもとの暗号文に対応した平文の最後の1バイトがわかる。
</p>

<p>
(ここに図を入れたい)
</p>

<small>
参考: <a href="http://developers.mobage.jp/blog/poodle">mobage developers blog</a>
</small>
