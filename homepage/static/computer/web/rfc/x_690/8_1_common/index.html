8.1 共通する構造

<h2>構造</h2>

<p>
以下のような構造を取る。
[end-of-contents]は[length]で長さを指定しなかった場合にのみ付加される。
</p>

<code>[identifier] [length] [contents] [end-of-contents]</code>

<ul>
<li>identifier: データの型を示す値</li>
<li>length: データの長さを示す値</li>
<li>contents: 実際のデータ</li>
<li>end-of-contents: [length]で長さを指定しない場合に必要</li>
</ul>

<h2>identifier octets</h2>

<p>
0から30までのタイプは1バイトで表現し、
31以上のタイプは複数バイトで表現される。
1バイト目の8,7ビット目と6ビット目、
そして1バイト目の残りのビットと2バイト目以降のバイトにはそれぞれ別々の意味がある。
</p>

<h3>1バイト目の8,7ビット目</h3>

<p>これらのビットは型の種類を表す。</p>

<ul>
<li>0 0: Universal</li>
<li>0 1: Application</li>
<li>1 0: Context-specific</li>
<li>1 1: Private</li>
</ul>

<h3>1バイト目の6ビット目</h3>

<p>
このビットが0ならばプリミティブなデータであり、
1ならば構成されたデータとなる。
</p>

<h3>1バイト目の残りのビットと残りのバイト</h3>

<p>
型にわりあてられた数値となる。
0から30まではそのまま1バイト目の5から1ビット目で表現する。
31以上の場合、1バイト目の5から1ビット目まではすべて1とし、
残りのバイトは以下のルールに従ってエンコードされる。
</p>

<p>
8ビット目はそのバイトにさらに他のバイトが続くかどうかを示す。
8ビット目が1であれば後続のバイトが存在するということであり、
0であればそれが最後のバイトであるということである。
7から1ビット目が実際の値を表す部分であり、
2バイト目以降のバイトのこの部分を、先に来たバイトをより高位の桁として、
つなぎ合わせた値が型にわりあてられた数ということになる。
</p>

<p>
ただし、2バイト目の7から1ビット目をすべて0としてはならない。
つまり、無駄な0を最上位の桁に置かないということ。
</p>

<h2>length octets</h2>

<p>
このフィールドでは長さを指定するか、あるいは長さを指定しないということを明示する。
</p>

<h3>長さを指定しない場合</h3>

<p>
このフィールドは1バイトの0xf0となる。
また、この場合にはデータの最後に[end-of-contents]フィールドを付加することになる。
</p>

<h3>長さを指定する場合</h3>

<p>
短い形式と長い形式のどちらを使っても良い。
ただし、短い形式では0から127までしか表現できない。
</p>

<h4>短い形式</h4>

<p>1バイトで表現する。8ビット目は0で残りの7から1ビット目で長さを表現する。</p>

<h4>長い形式</h4>

<p>
1バイト目の8ビット目は1とする。残りの7から1ビット目で、
長さを表現するのに使用されるバイト数を指定する。
ただし、0xFFは使わないほうが良いらしい
(そんな長い数を使う必要のある機会なんてない気もするけれど)。
</p>

</p>
残りのバイトで実際の長さを表現する。
先行するバイトを高位の桁としてバイトをつなげた値。
</p>

<h2>end-of-contents octets</h2>

<p>
このフィールドは[length]で長さを指定しなかったときには付加してはならない。
長さを指定しなかったときのみ付加する。
このフィールドは以下のような値となる。
</p>

<pre><code>0x00 0x00</code></pre>

<p>
0x00を2つ並べたものということだ。
</p>

<h3>このフィールドの解釈</h3>

<p>
このフィールドはタイプ0の長さが0のデータとして考えることもできる。
</p>

<p>
<a href="/computer/web/rfc/x_690">X.690のトップへもどる</a>
<a href="/computer/web/rfc/x_690/8_1_common/coding.html"
	>ASN.1の共通部分までのコーディング例(工事中 0%)</a>
</p>
