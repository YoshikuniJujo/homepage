型駆動開発

<h2>型駆動開発とは</h2>

<p>
コードを書く前に型を考えることで開発効率の向上が期待できる。
「型から考える」コーディングを「型駆動開発」とここでは呼んでおく。
</p>

<h2>題材</h2>

<p>
身長と体重を入力するとBMIを計算し肥満かどうか判断する関数を作成する。
</p>

<h2>BMIとは</h2>

<p>
<a href="https://ja.wikipedia.org/wiki/ボディマス指数">BMI</a>とは
体重と身長から計算される肥満度を表す指数だ。
以下の式で計算する。
</p>

<pre><code>BMI = [体重(kg)] / [身長(m)] ^ 2</code></pre>

<img
alt="[BMIの人達の図]"
src="/computer/haskell/web_lecture/for_programmer/images/bmi_men.svg"
/>

<p>日本の基準では25以上が肥満となっている。</p>

<h2>仕様</h2>

<p>
身長と体重を引き数に取り肥満かどうかを表す値を返り値とする。
身長はcm単位とする。
</p>

<h2>型についての考察</h2>

<p>
BMIは少数点以下も意味があるので実数とする。
Haskellでの代表的な実数型はDouble型だ。
体重、身長、BMIはDouble型の値とする。
肥満かどうかは真か偽かなのでTrueとFalseを値とするBool型が良いだろう。
</p>

<h2>定義する関数</h2>

<p>
BMIを求めて25と比較して真偽値を返す。
関数bmiとそれを利用する関数isObeseを作成する。
それぞれの型は以下のようになる。
</p>

<code>bmi :: Double -&gt; Double -&gt; Double<br/>
isObese :: Double -&gt; Double -&gt; Bool</code>

<p>
bmiは身長(Double)と体重(Double)を取ってBMI(Double)を返す関数。
isObeseは身長と体重を取って肥満かどうか(Bool)を返す関数である。
</p>

<h2>型をさきに定義</h2>

<p>
型駆動開発とかかげたので型をさきに定義する。
型の情報をさきにGHCiでチェックしてみる。
型宣言のみでは読み込みエラーとなるのでスタブとしてエラー値undefinedを使おう。
</p>

<p><a href="/computer/haskell/web_lecture/for_programmer/04_type_driven/bmi_v0.hs"
	>bmi.hs</a></p>

<pre><code>bmi :: Double -&gt; Double -&gt; Double
bmi = undefined

isObese :: Double -&gt; Double -&gt; Bool
isObese = undefined</code></pre>

<p>型を表示してみよう。</p>

<pre><code>% ghci bmi.hs
*Main&gt; :t bmi
bmi :: Double -&gt; Double -&gt; Double
*Main&gt; :t isObese
isObese :: Double -&gt; Double -&gt; Bool</code></pre>

<p>呼び出そうとするとエラーとなる。</p>

<pre><code>*Main&gt; bmi 172 66
*** Exception: Prelude.undefined
*Main&gt; isObese 172 66
*** Exception: Prelude.undefined</code></pre>

<h2>トップダウンかボトムアップか</h2>

<p>
トップダウンか、ボトムアップかという問題がある。
どちらにも利点・欠点がある。
</p>

<img
alt="[トップダウンの図]"
src="/computer/haskell/web_lecture/for_programmer/images/topdown.svg"
/>

<img
alt="[ボトムアップの図]"
src="/computer/haskell/web_lecture/for_programmer/images/bottomup.svg"
/>

<p>
トップダウンでは全体の構成がわかりやすくなる。
それぞれの部品が果たす役割が明確となる。
反面、実装について十分に考慮しないと
部品を作るときに二重化等の無駄が出てしまう。
ボトムアップでは汎用の部品を作ることが意識される。
流用の利くものを作ることで仕様の変更に強くなる。
反面、全体を構成する部品としての役割を配慮しないと、
実際に使うときに手直しが必要になる。
</p>

<p>
BMIの例では関数isObeseをさきに作ればトップダウンな開発となる。
関数bmiをさきに作ればボトムアップな開発となる。
isObeseをさきに作るときは「もしbmiが適切に定義されているならば」と仮定する。
このような仮定は再帰関数の作成にも必要だ。
慣れのためにトップダウンの手法を使う。
</p>

<h2>関数isObeseの定義</h2>

<p>
「関数bmiがBMI値を返すならば」isObese関数はその返り値が25以上かどうかを返せば良い。
</p>

<p><a href="/computer/haskell/web_lecture/for_programmer/04_type_driven/bmi_v1.hs"
	>bmi.hs</a></p>

<pre><code>isObese h w = bmi h w &gt;= 25</code></pre>

<h2>関数bmiの定義</h2>

<p>
関数bmiは身長(h)と体重(w)からBMIを計算する。
身長はcmからmに変換するので100分の1にする。
</p>

<p><a href="/computer/haskell/web_lecture/for_programmer/04_type_driven/bmi_v2.hs"
	>bmi.hs</a></p>

<pre><code>bmi h w = w / (h / 100) ^ 2</code></pre>

<h2>試してみる</h2>

<p>172cmは日本人男性の平均身長から。</p>

<pre><code>*Main&gt; :reload
*Main&gt; isObese 172 70
False
*Main&gt; isObese 172 80
True</code></pre>

<p>
<a href="/computer/haskell/web_lecture/for_programmer/type_declaration.html"
	>「型宣言」へもどる</a>
<a href="/computer/haskell/web_lecture/for_programmer/import.html"
	>「モジュールの読み込み」へ</a>
</p>
