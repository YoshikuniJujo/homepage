型駆動開発

<h2>型駆動開発とは</h2>

<p>
コードを書く前に型を考えることで開発効率の向上が期待できる。
「型から考える」コーディングを「型駆動開発」と呼ぼう。
</p>

<h2>題材</h2>

<p>身長と体重からBMIを計算し肥満かどうか判定する関数。</p>

<h2>BMIとは</h2>

<p>
<a href="https://ja.wikipedia.org/wiki/ボディマス指数">BMI</a>とは
体重と身長から計算される肥満度を表す指数。
</p>

<pre><code>BMI = [体重(kg)] / [身長(m)] ^ 2</code></pre>

<img
alt="[BMIの人達の図]"
src="/computer/haskell/web_lecture/for_programmer/images/bmi_men.svg"
/>

<p>日本の基準では25以上が肥満とされる。</p>

<h2>仕様</h2>

<p>
身長と体重を引き数とし肥満かどうかを表す値を返り値とする。
身長はcm単位とする。
</p>

<h2>型についての考察</h2>

<p>
BMIは少数点以下も意味があるので実数とする。
Haskellでの代表的な実数型はDouble型だ。
体重、身長、BMIはDouble型の値とする。
肥満かどうかは真か偽かなのでTrueとFalseを値とするBool型で良いだろう。
</p>

<h2>定義する関数</h2>

<p>
BMIを求めて25と比較して真偽値を返す。
関数bmiとそれを利用する関数isObeseを作成する。
</p>

<code>bmi :: Double -&gt; Double -&gt; Double<br/>
isObese :: Double -&gt; Double -&gt; Bool</code>

<p>
bmiは身長(Double)と体重(Double)を取ってBMI(Double)を返す。
isObeseは身長と体重を取って肥満かどうか(Bool)を返す。
</p>

<h2>型をさきに定義</h2>

<p>
型駆動開発とかかげたので型をさきに定義する。
型の情報をさきにGHCiでチェックする。
型宣言のみでは読み込みエラーとなるのでエラー値undefinedをスタブとする。
</p>

<p><a href="/computer/haskell/web_lecture/for_programmer/04_type_driven/bmi_v0.hs"
	>bmi.hs</a></p>

<p><code>bmi :: Double -&gt; Double -&gt; Double<br/>
bmi = undefined</code></p>

<p><code>
isObese :: Double -&gt; Double -&gt; Bool<br/>
isObese = undefined</code></p>

<p>確かめてみる。</p>

<p><code>% ghci bmi.hs<br/>
*Main&gt; :t bmi<br/>
bmi :: Double -&gt; Double -&gt; Double<br/>
*Main&gt; :t isObese<br/>
isObese :: Double -&gt; Double -&gt; Bool</code></p>

<p>関数を呼び出すとエラーが発生する。</p>

<p><code>*Main&gt; bmi 172 66<br/>
*** Exception: Prelude.undefined<br/>
*Main&gt; isObese 172 66<br/>
*** Exception: Prelude.undefined</code></p>

<h2>トップダウンかボトムアップか</h2>

<p>
トップダウンか、ボトムアップかという問題がある。
それぞれ利点・欠点がある。
</p>

<img
alt="[トップダウンの図]"
src="/computer/haskell/web_lecture/for_programmer/images/topdown.svg"
/>

<img
alt="[ボトムアップの図]"
src="/computer/haskell/web_lecture/for_programmer/images/bottomup.svg"
/>

<p>
トップダウンでは全体の構成がわかりやすい。
それぞれの部品が果たす役割が明確だ。
反面、実装について十分に考慮しないと
部品を作るときに二重化等の無駄が出る。
ボトムアップでは汎用の部品を作ることを意識する。
流用の利くものが作られ仕様の変更に強くなる。
反面、全体を構成する部品としての役割を配慮しないと、
組み込むときに手直しが必要になる。
</p>

<p>
BMIの例では関数isObeseをさきに作ればトップダウンな開発となる。
関数bmiをさきに作ればボトムアップな開発となる。
isObeseをさきに作るときは「もしbmiが適切に定義されているならば」と仮定する。
この仮定は再帰関数の作成にも必要だ。
慣れのためにトップダウンの手法を使う。
</p>

<h2>関数isObeseの定義</h2>

<p>
「関数bmiがBMI値を返すならば」関数isObeseはその返り値が25以上かどうかを返せば良い。
</p>

<p><a href="/computer/haskell/web_lecture/for_programmer/04_type_driven/bmi_v1.hs"
	>bmi.hs</a></p>

<pre><code>isObese h w = bmi h w &gt;= 25</code></pre>

<h2>関数bmiの定義</h2>

<p>
関数bmiは身長(h)と体重(w)からBMIを計算する。
身長はcmからmに変換する。100分の1にする。
</p>

<p><a href="/computer/haskell/web_lecture/for_programmer/04_type_driven/bmi_v2.hs"
	>bmi.hs</a></p>

<pre><code>bmi h w = w / (h / 100) ^ 2</code></pre>

<h2>試してみる</h2>

<p>172cmは日本人男性の平均身長。</p>

<p><code>*Main&gt; :reload<br/>
*Main&gt; isObese 172 70<br/>
False<br/>
*Main&gt; isObese 172 80<br/>
True</code></p>

<p>
<a href="/computer/haskell/web_lecture/for_programmer/type_declaration.html"
	>「型宣言」へもどる</a>
<a href="/computer/haskell/web_lecture/for_programmer/import.html"
	>「モジュールの読み込み」へ</a>
</p>
