関数を作ってみる

<h2>題材</h2>

<p>
意味のある関数のほうが面白いのでRSA暗号を題材とする。
関数定義を学ぶのが目的なのでRSA暗号の深い話はしない。
鍵の作りかたは説明しない。
こちらで用意した鍵のペアを使う暗号化、復号関数を作っていく。
</p>

<h2>公開鍵暗号</h2>

<p>
国民の本音を知りたい王様がいる。
部下である大臣の評判を知りたい。
そこでメッセージを入れる箱をたくさん作り各家庭に配る。
しかし、そのメッセージを大臣が読んでしまうと国民は本音が書けない。
箱や箱の鍵をとどけられるのは大臣だけだ。
どうしたらいいだろう。
王様は特別な箱を作らせる。
その箱はしめるときとあけるときで別々の鍵を使う。
「あける鍵」は王様だけが持っている。
「しめる鍵」と箱をセットにして国民にとどければ良い。
国民は箱にメッセージを入れて「しめる鍵」を使ってしめる。
大臣はそれを王様に運ぶ。
とちゅうで箱をあけようとしても大臣の手に入る鍵は「しめる鍵」だけだ。
箱をあけられるのは「あける鍵」を持っている王様だけだ。
</p>

<img
alt="[公開鍵暗号のメタファーの図]"
src="/computer/haskell/web_lecture/for_programmer/images/public_key_metaphor.svg"
/>

<p>
これが公開鍵暗号の考えかただ。
暗号化のための鍵を公開しメッセージを暗号化して送ってもらう。
送られてきたメッセージは自分だけが知っている復号のための鍵で復号する。
不特定多数の人からの秘密のメッセージの受信が可能となる。
</p>

<h2>RSA暗号とは</h2>

<p>
適切に選ばれた3つの値e, d, nを使って単純な計算で公開鍵暗号を実装できる。
HTTPSの鍵交換に使われている。
</p>

<h2>RSA暗号の計算式</h2>

<h3>Haskellの記法に慣れる</h3>

<p>
RSA暗号の暗号化と復号の計算は平文m、暗号文cで以下のようになる。
暗号化ではmをe乗したものをnで割った余りを求める。これがcとなる。
復号はcをd乗したものをnで割った余りを求めれば良い。これはmにもどる。
必要な演算はべき乗と剰余の計算だ。
これらの計算のHaskellでの表記を見てみよう。
</p>

<pre><code>% ghci
Prelude&gt; 2 ^ 10
1024
Prelude&gt; 13 `mod` 5
3</code></pre>

<p>
2の10乗は'^'を使って2 ^ 10のように表す。
13を5で割った余りは13 `mod` 5のように表す。
modをバッククォートで囲んでいることに注意する。
バッククォートで囲む理由は後で説明する。
</p>

<h3>暗号化、復号をHaskellの記法で表現</h3>

<p>
RSA暗号における暗号化と復号とをHaskellの記法で表現すると以下のようになる。
</p>

<p><code>c = m ^ e `mod` n<br/>
m = c ^ d `mod` n</code></p>

<p>
e, d, nは適切に選んでやる必要がある。
ここではe = 13, d = 95497, n = 138689とする。
</p>

<h2>対話環境での暗号化と復号</h2>

<p>
「let 変数 = 式」のようにすると対話環境内で変数を定義することができる。
</p>

<pre><code>Prelude&gt; let e = 13
Prelude&gt; let d = 95497
Prelude&gt; let n = 138689
Prelude&gt; 12345 ^ e `mod` n
47046
Prelude&gt; 47046 ^ d `mod` n
12345
Prelude&gt; 4492 ^ e `mod` n
47255
Prelude&gt; 47255 ^ d `mod` n
4492</code></pre>

<p>
暗号化された値がちゃんと復号された。
(13, 138689)が公開鍵であり95497が秘密鍵である。
</p>

<h2>暗号化関数、複号関数</h2>

<p>
暗号化と復号のそれぞれの関数を作成する。
nとeの値と平文を引数として与えると暗号文を返す関数と、
nとdの値と暗号文を引数として与えると平文を返す関数を作成する。
以下のような内容のファイルを作成する。
</p>

<p><a
href="/computer/haskell/web_lecture/for_programmer/01_make_function/rsa.hs"
	>rsa.hs</a></p>

<pre><code>encrypt n e m = m ^ e `mod` n
decrypt n d c = c ^ d `mod` n</code></pre>

<p>
関数名に続けて仮引数をスペースで区切って並べている。
C言語系の言語のように引数の全体を丸括弧で囲んだり、
あいだをカンマで区切ったりしない。
関数の本体の部分を波括弧で囲う必要もない。
'='でつなぐだけだ。
</p>

<p>
試してみよう。
ghciを終了していたならば以下のよう読み込む。
</p>

<pre><code>% ghci rsa.hs</code></pre>

<p>
ghciを立ち上げたままならば以下のように':load'で読み込むこともできる。
</p>

<pre><code>Prelude&gt; :load rsa.hs</code></pre>

<p>
読み込んだら次のように入力する。
</p>

<pre><code>*Main&gt; encrypt 138689 13 12345
47046
*Main&gt; decrypt 138689 95497 47046
12345</code></pre>

<p>ちゃんと復号できた。</p>

<h2>まとめ</h2>

<p>
関数の定義のしかたと使いかたを見た。
それぞれ以下のようになる。
</p>

<ul>
<li>定義: [関数名] [仮引数1] [仮引数2] ... = [表現]</li>
<li>使用: [関数名] [実引数1] [実引数2] ...</li>
</ul>

<h2>課題</h2>

<ol>
<li>対話環境内で変数を定義してみよう
	<ul>
	<li>myAge変数を自分の年齢で束縛する</li>
	<li>myAge変数の値を表示する</li>
	</ul></li>
<li>対話環境内からの定義ファイルの読み込み
	<ul>
	<li>myAge変数を定義したファイルを用意する</li>
	<li>引数無しでghciコマンドを実行し対話環境内で上記ファイルを読み込む</li>
	</ul></li>
<li>関数定義の練習: 以下の関数を作成し対話環境に読み込み試してみよう
	<ul>
	<li>引数を2倍する関数double</li>
	<li>2つの引数m, nを取り、2のm乗と3のn乗をかけた値を返す関数mul23</li>
	</ul></li>
</ol>

<p>
<a href="/computer/haskell/web_lecture/for_programmer/touch_ghci.html"
	>「対話環境に触れる」へもどる</a>
<a href="/computer/haskell/web_lecture/for_programmer/partial_application.html"
	>「部分適用」へ</a>
</p>
