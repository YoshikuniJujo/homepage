演算子

<h2>演算子とは</h2>

<p>
演算子とは特殊な記法が可能な2引数関数と考えることができる。
普通の関数は前置記法であるのに対して演算子は中置記法となる。
</p>

<img
width="200"
alt="[演算子の図]"
src="/computer/haskell/web_lecture/for_programmer/images/operator.svg"
/>

<p>
演算子の前後に置かれた値をそれぞれ第1、第2引数と考えることができる。
</p>

<h2>演算子は関数である</h2>

<p>
演算子は本質的に関数と同じだ。
表記上の違いがあるだけだ。
3 + 8は関数(+)に3と8を与えるのと同じだ。
確認してみよう。
</p>

<pre><code>% ghci
Prelude&gt; 3 + 8
11
Prelude&gt; (+) 3 8
11</code></pre>

<img
width="250"
alt="[演算子は関数であるの図]"
src="/computer/haskell/web_lecture/for_programmer/images/operator_is_function.svg"
/>

<p>
演算子は丸括弧で囲ってやることで関数として扱うことができる。
</p>

<h2>関数は演算子である</h2>

<p>
前に出てきた剰余を求める関数modがある。
これを今までは中置演算子として使ってきたが、これは普通の関数である。
</p>

<pre><code>Prelude&gt; mod 15 4
3
Prelude&gt; 15 `mod` 4
3</code></pre>

<img
width="250"
alt="[関数は演算子であるの図]"
src="/computer/haskell/web_lecture/for_programmer/images/function_is_operator.svg"
/>

<p>
関数はバッククォートで囲ってやることで演算子として使うことができる。
</p>

<h2>演算子の部分適用</h2>

<p>
演算子に関しては左側(第1引数)、右側(第2引数)のどちらについても部分適用が可能だ。
</p>

<pre><code>Prelude&gt; (3 +) 8
11
Prelude&gt; (+ 8) 3
11</code></pre>

<p>
(3 +)は(+)の第1引数のみに値3を与えたものだ。
よって与えられた引数を3に足す関数が返る。
(+ 8)は(+)の第2引数のみに値8を与えたものだ。
これは与えられた引数に8を足す関数となる。
</p>

<h3>演算子化した関数への部分適用</h3>

<p>演算子化した関数にも同様の部分適用ができる。</p>

<pre><code>Prelude&gt; (`mod` 4) 15
3
Prelude&gt; (15 `mod`) 4
3</code></pre>

<h2>演算子の定義</h2>

<p>演算子の定義は関数定義と同じようにすれば良い。</p>

<pre><code>(+++) a b = ...</code></pre>

<p>あるいは、中置記法を使っても良い。</p>

<pre><code>a +++ b = ...</code></pre>

<h3>演算子に使える記号</h3>

<p>演算子にはアスキー記号の範囲内では以下のものが使える。</p>

<code>!#$%&amp;*+./&lt;=&gt;?@\^|-~:</code>

<p>
ただし':'ではじまる記号列は別の用途で使われるため普通の演算子としては使えない。
</p>

<h3>演算子を定義してみよう</h3>

<p>
コードゴルフという競技がある。
与えられたお題でどれだけ短いコードが書けるかという競争だ。
短くするのに長い関数に短い別名をつけるという手法がある。
たとえば以下のようなコードがあったとする。
</p>

<p><code>f x y=someLongFunction x+someLongFunction y</code></p>

<p>
43文字である。
このコードは以下のようにすることで文字数を減らすことができる。
</p>

<p><code>l=someLongFunction<br/>
f x y=l x+l y</code></p>

<p>
これは改行を入れて32文字だ。
11文字減らすことができた。
このような変換によって減らすことのできる文字数は
関数の長さとそれが使われている回数とから計算することができる。
</p>

<p>
もとの関数の長さをlenとしその関数の使われている場所の数をtmsとする。
その関数を一文字の関数に置き換えることで減らせる文字数は(len - 1) * tmsとなる。
そして一文字の別名をつけるために改行も含めて(len + 3)文字使う。
よってこの変換によって減らせる文字数は以下のような式となる。
</p>

<p><code>(len - 1) * tms - (len + 3)</code></p>

<p>
演算子の名前を考えよう。
この演算は掛け算に似ている。
それに「減らす」イメージを追加して\*\としてみよう。
</p>

<p><a href="/computer/haskell/web_lecture/for_programmer/03_2_operator/golf.hs"
	>golf.hs</a></p>

<p><code>len \*\ tms = (len - 1) * tms - (len + 3)</code></p>

<p>
試してみよう。
上記の例ではsomeLongFunctionが16文字で2回使われていた。
この場合に11文字減らすことができる。
</p>

<p><code>ghci golf.hs<br/>
*Main&gt; 16 \*\ 2<br/>
11<br/>
*Main&gt; 3 \*\ 3<br/>
0<br/>
*Main&gt; 3 \*\ 2<br/>
-2<br/>
</code></p>

<p>
3文字の関数を3回使っている場合には変換によって文字数は変化せず、
3文字の関数を2回使っている場合には変換によってむしろ2文字増えてしまうことがわかる。
</p>

<h2>関数の演算子的な定義</h2>

<p>
関数も演算子的な記法で定義することができる。
以下のような定義を見てみよう。
</p>

<code>op a b = ...</code>

<p>これを以下のように書くことができる。</p>

<code>a `op` b = ...</code>

<h2>まとめ</h2>

<p>
演算子の表現に使えるのは記号列であり演算子の記法は中置記法である。
それ以外は2引数関数と同じだ。
()や``でそれぞれの向きに変換することができる。
演算子の定義にも中置記法が使える。
</p>

<h2>課題</h2>

<ol>
<li></li>
</ol>

<p>
<a href="/computer/haskell/web_lecture/for_programmer/higher_order.html"
	>「高階関数」へもどる</a>
<a href="/computer/haskell/web_lecture/for_programmer/maybe.html"
	>「Maybe型」へ</a>
</p>
