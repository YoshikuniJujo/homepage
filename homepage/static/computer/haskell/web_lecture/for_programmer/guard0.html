ガード

<h2>はじめに</h2>

<p>
関数を定義するとき、パターンマッチではなく、
条件によって処理を分岐させたいことがある。
0の場合だけを特別扱いにする場合にはパターンマッチが使える。
しかし、
0未満の場合と0以上の場合とで処理を分けるときには
パターンマッチを直接使うことはできない。
</p>

<h2>0未満を考慮した平方根</h2>

「0未満のときにはNothingを返す関数sqrt'」を定義する。

<h3>今まで学んできた範囲内で</h3>

<p>今まで学んできた内容のみで定義してみる。</p>

<p><a href="/computer/haskell/web_lecture/for_programmer/03_7_guard0/sqrt0.hs"
	>sqrt0.hs</a></p>

<pre><code>sqrt' x = sqrtBool (x &lt; 0) x</code></pre>

<pre><code>sqrtBool True _ = Nothing
sqrtBool _ x = Just (sqrt x)</code></pre>

<h3>ガードを使う</h3>

<p>Bool値に対するパターンマッチは頻出なので略記法がある。</p>

<p><a href="/computer/haskell/web_lecture/for_programmer/03_7_guard0/sqrt1.hs"
	>sqrt1.hs</a></p>

<p><code>sqrt' x<br/>
	<span class="indent1">| x &lt; 0 = Nothing</span><br/>
	<span class="indent1">| otherwise = Just (sqrt x)</span></code></p>

<h2>ガードの記法</h2>

<p>ガードは以下のような記法で使われる。</p>

<p><code>[関数名] [引数1] [引数2] ...<br/>
	<span class="indent1">| [Bool値を返す式1] = [結果の式1]</span><br/>
	<span class="indent1">| [Bool値を返す式2] = [結果の式2]</span><br/>
		<span class="indent2">...</span><br/>
	<span class="indent1">| otherwise = [結果の式n]</span></code></p>

<p>
「Bool値を返す式」がガードだ。
ガードがFalseなら次のガードへ進む。
Trueなら対応する「結果の式」が全体の結果となる。
otherwiseはpiと同じように束縛ずみの変数だ。
Trueに束縛されている。
読みやすさのために定義されているだけなので直接Trueと書いても良い。
</p>

<h2>レイアウトルールについてすこし</h2>

<p>
Haskellにはレイアウトルールがある。
明示的に{}で囲ったり';'で区切ったりする代わりに、
見た目に分かりやすいレイアウトで構造を表現できる。
</p>

<p>
同じレベルの要素、つまり兄弟要素、同士の列挙ではインデントの深さをそろえる。
タブは8文字タブとして扱われる。
関数定義同士は兄弟要素なのでインデント0でそろえれば良い。
</p>

<img
alt="[レイアウトルールの図]"
src="/computer/haskell/web_lecture/for_programmer/images/layout_rule_0.svg"
/>

<p>
1行が長くなるときや、わかりやすさのために複数行にわけるときは、
インデントを大きくし続きであることを示す。
</p>

<pre><code>some n = n * 1234567890 + 9876543210
	* 789345123</code></pre>

<p>
* 789345123の行は関数定義の行よりインデントが深くなっている。
関数someの定義の続きとなる。
インデントしないと'* 789345123'が新たな定義のはじまりと解釈されエラーとなる。
</p>

<p>ガードには改行は必要ない。</p>

<code>sqrt' x | x &lt; 0 = Nothing | otherwise = Just (sqrt x)</code>

<p>
たいていは見やすさのために複数行にわける。
ガードが関数定義の続きであることを示すために、
関数定義の1行目よりも深くインデントする。
</p>

<h2>まとめ</h2>

<p>
True, Falseに対するパターンマッチは頻出なので略記法がある。
関数定義につけることができるガードだ。
以下の表記で関数定義に複数つけられる。
</p>

<pre><code>	| [Bool値を返す式] = [結果となる式]</code></pre>

<h2>課題</h2>

<ol>
<li>引数が3の倍数ならば3で割った値を、
そうでないならそのままの値を返す関数div3を定義せよ<ul>
	<li>同値性をチェックする演算子(==)が使える</li>
</ul></li>
</ol>

<p>
<a href="/computer/haskell/web_lecture/for_programmer/pattern_match.html"
	>「パターンマッチ」へもどる</a>
<a href="/computer/haskell/web_lecture/for_programmer/whats_type.html"
	>「型とは何か」へ</a>
</p>
