ガード

<h2>はじめに</h2>

<p>
パターンマッチではなく条件によって処理をわけたい。
0だけを特別扱いするにはパターンマッチで良い。
0未満と0以上で処理をわけるにはパターンマッチは直接は使えない。
</p>

<h2>0未満を考慮した平方根</h2>

<p>0未満ではNothingを返す関数sqrt'を考える。</p>

<h3>今まで学んできた範囲内で</h3>

<p><a href="/computer/haskell/web_lecture/for_programmer/03_7_guard0/sqrt0.hs"
	>sqrt0.hs</a></p>

<p><code>sqrt' x = sqrtBool (x &lt; 0) x</code></p>

<p><code>sqrtBool True _ = Nothing<br/>
sqrtBool _ x = Just (sqrt x)</code></p>

<p>補助関数sqrtBoolでTrue, Falseにマッチさせる。</p>

<h3>ガードを使う</h3>

<p>Bool値に対するパターンマッチは頻出なので略記法がある。</p>

<p><a href="/computer/haskell/web_lecture/for_programmer/03_7_guard0/sqrt1.hs"
	>sqrt1.hs</a></p>

<p><code>sqrt' x<br/>
	<span class="indent1">| x &lt; 0 = Nothing</span><br/>
	<span class="indent1">| otherwise = Just (sqrt x)</span></code></p>

<h2>構文</h2>

<p><code>[関数名] [引数1] [引数2] ...<br/>
	<span class="indent1">| [Bool値を返す式1] = [結果の式1]</span><br/>
	<span class="indent1">| [Bool値を返す式2] = [結果の式2]</span><br/>
		<span class="indent2">...</span><br/>
	<span class="indent1">| otherwise = [結果の式n]</span></code></p>

<p>
「Bool値を返す式」がガードだ。
ガードがFalseなら次のガードへ進む。
Trueなら対応する「結果の式」が返される。
変数otherwiseは変数piのように定義ずみの変数でありTrueに束縛されている。
読みやすさのために定義されている。直接Trueと書いても同じだ。
</p>

<h2>レイアウトルールをすこし</h2>

<p>
{}でかこったり';'でくぎったりせずにレイアウトで構造を表現できる。
同じレベルの兄弟要素の列挙はインデントをそろえる。タブは8タブだ。
関数定義同士は兄弟要素だ。ふつうはインデント0でそろえる。
</p>

<img
alt="[レイアウトルールの図]"
src="/computer/haskell/web_lecture/for_programmer/images/layout_rule_0.svg"
/>

<p>
1行が長くなるときやわかりやすさのために複数行にわけるときは
インデントを深くして続きであることを示す。
</p>

<pre><code>some n = n * 1234567890 + 9876543210
	* 789345123</code></pre>

<p>
* 789345123の行は関数定義の行よりインデントが深いので関数someの定義の続きとなる。
インデントがないと* 789345123が新たな定義のはじまりと解釈されエラーとなる。
</p>

<p>ガードには改行は不要だ。</p>

<p><code>sqrt' x | x &lt; 0 = Nothing | otherwise = Just (sqrt x)</code></p>

<p>
たいていは見やすさのために複数行にわける。
ガードは関数定義の続きなので関数定義の1行目より深くインデントする。
</p>

<h2>まとめ</h2>

<p>
True, Falseに対するパターンマッチは頻出なのでガードという略記法がある。
ガードは関数定義に複数つけられる。
</p>

<p><code><span class="indent1">| [Bool値を返す式] = [結果となる式]</span></code></p>

<h2>課題</h2>

<ol>
<li>3の倍数なら3で割りそれ以外はそのままにする関数div3を定義せよ<ul>
	<li>関数mod、div、演算子(==)を使う</li>
</ul></li>
</ol>

<p>
<a href="/computer/haskell/web_lecture/for_programmer/pattern_match.html"
	>「パターンマッチ」へもどる</a>
<a href="/computer/haskell/web_lecture/for_programmer/whats_type.html"
	>「型とは何か」へ</a>
</p>
