ガード

<h2>はじめに</h2>

<p>
関数を定義する場合、単にパターンマッチするだけでなく、
条件によって処理を分岐させたいことがある。
たとえば0の場合だけを特別扱いにする場合にはパターンマッチで良い。
しかし、
0未満の場合と0以上の場合とで処理を分けるのは直接的なパターンマッチではできない。
</p>

<h2>0未満を考慮した平方根</h2>

「0未満のときにはNothingを返すsqrt'」を定義する。

<h3>今まで学んできた範囲内で</h3>

<p>
今まで学んできた内容のみで定義すると以下のようになる。
</p>

<p><a href="/computer/haskell/web_lecture/for_programmer/03_7_guard0/sqrt0.hs"
	>sqrt0.hs</a></p>

<pre><code>sqrt' x = sqrtBool (x &lt; 0) x</code></pre>

<pre><code>sqrtBool True _ = Nothing
sqrtBool _ x = Just $ sqrt x</code></pre>

<h3>ガードを使う</h3>

<p>
Bool値に対するパターンマッチは頻出なので略記法がある。
以下のように書ける。
</p>

<p><a href="/computer/haskell/web_lecture/for_programmer/03_7_guard0/sqrt1.hs"
	>sqrt1.hs</a></p>

<pre><code>sqrt' x
	| x &lt; 0 = Nothing
	| otherwise = Just $ sqrt x</code></pre>

<h2>ガードの記法</h2>

<p>ガードは以下のような記法で使われる。</p>

<pre><code>[関数名]
	| [Bool値を返す式1] = [結果の式1]
	| [Bool値を返す式2] = [結果の式2]
		...</code></pre>

<p>
Bool値を返す式の部分がガードである。
ガードの部分がTrueになるまで上から順に見ていって、
Trueになったら対応する「結果の式」が全体の結果となる。
また、sqrt'の例にあるotherwiseはpiと同じように事前に束縛された変数である。
Trueに束縛された単なる変数だ。
読みやすさのために定義されている。
</p>

<h2>レイアウトルールについてすこし</h2>

<p>
Haskellにはレイアウトルールというものが存在する。
このルールによって明示的に{}で囲ったり';'で区切ったりする代わりに、
見た目に分かりやすいレイアウトによって、それらの構造を表現することができる。
ここではそのレイアウトルールのうちのほんの一部を紹介する。
</p>

<p>
同じレベルの要素の列挙、
つまり兄弟要素同士はインデントの深さをそろえることで示される。
タブは8文字タブとして扱われる。
関数定義同士は兄弟要素となるのでインデントは0でそろっていた。
</p>

<img
alt="[レイアウトルールの図]"
src="/computer/haskell/web_lecture/for_programmer/images/layout_rule_0.svg"
/>

<p>
1行に入り切らない場合や、わかりやすさのために複数行に分けたい場合、
インデントを0より大きくすることで、関数定義の続きであることを示すことができる。
以下のようにすることができる。
</p>

<pre><code>some n = n * 1234567890 + 9876543210
	* 789345123</code></pre>

<p>
* 789345123の行は関数定義の行よりインデントが深くなっているため、
関数someの定義の続きとなる。
もしもこの行をインデントしなかった場合、
* 789345123の行は新たな定義のはじまりとして解釈されるためエラーとなる。
</p>

<p>
ガードには本来改行は必要ない。
以下のように続けて書くことは可能だ。
</p>

<code>sqrt' x | x &lt; 0 = Nothing | otherwise = Just $ sqrt x</code>

<p>
しかし、たいていは見やすさのために複数行に分ける。
そのとき、ガードが関数定義の続きであることを示すために、
関数定義の1行目よりも深くインデントする必要がある。
</p>

<h2>まとめ</h2>

<p>
True, Falseに対するパターンマッチはしばしば使われるので、略記法が用意されている。
そのうちのひとつが関数につけることができるガードであり、以下のような表記で、
複数つけることができる。
</p>

<pre><code>	| [Bool値を返す式] = [結果となる式]</code></pre>

<h2>課題</h2>

<ol>
<li>引数が3の倍数ならば3で割った値を、
そうでないならそのままの値を返す関数div3を定義せよ<ul>
	<li>同値性をチェックする演算子(==)を使用する</li>
</ul></li>
</ol>

<p>
<a href="/computer/haskell/web_lecture/for_programmer/pattern_match.html"
	>「パターンマッチ」へもどる</a>
<a href="/computer/haskell/web_lecture/for_programmer/whats_type.html"
	>「型とは何か」へ</a>
</p>
