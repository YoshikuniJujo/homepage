構文: レイアウトルール

<p>(工事中 0%)</p>

<h2>はじめに</h2>

<p>
case式やlet式、where節はインデントで構文を表現している。
インデントによって{}や;を追加する場所を決めている。
Haskell 2010 reportの2.7節で概要が説明されている。
10.3節では正確な仕様が規定されている。
インデントルールを使わないで明示的に{}や;を記述することもできる。
</p>

<p><a href="https://www.haskell.org/onlinereport/haskell2010/haskellch2.html#x7-210002.7"
	>Haskell 2010 report: 2.7 Layout</a></p>

<p><a href="https://www.haskell.org/onlinereport/haskell2010/haskellch10.html#x17-17800010.3"
	>Haskell 2010 report: 10.3 Layout</a></p>

<h2>概要</h2>

<h3>どっちも</h3>

<p>
Haskellではレイアウトルールを使うことも明示的に{}と;を使うこともできる。
混ぜても良い。
</p>

<h3>レイアウトルールの仕組み</h3>

<p>レイアウトによって{}と;を適切な位置に追加する。</p>

<h3>レイアウトルールの開始</h3>

<p>レイアウトルールは以下のキーワードのあとに{が省略されたときに始まる。</p>

<p><code>where, let, do, of</code></p>

<p>
キーワードdoはモナドを学んだあとに説明する。
{の省略を見つけるとその次に来る語のインデントを記録する。
また、その語の前に{を追加しておく。
</p>

<h3>続き</h3>

<p>
空白行やより深いインデントは「続き」であることを意味する。
;は追加されない。
</p>

<h3>次の要素</h3>

<p>
インデントルールのはじめで記録されたのと同じ深さのインデントのとき、
次の要素として解釈される。
;が追加される。
</p>

<h3>終了</h3>

<p>
インデントが浅くなったときそのレイアウトルールは終了となる。
}が追加される。
</p>

<h3>開始後すぐに終了</h3>

<p>
インデントルールがネストしたときに内側のルール開始後すぐに終了することがある。
インデントルールを開始するキーワードのあとにすぐ外側のルールのインデントと
同じかまたはより浅いインデントだったときは内側のルールはすぐに終了することになる。
このとき{}が追加される。
</p>

<h3>構文エラーによる終了</h3>

<p>
上記以外でも}が追加されるときがある。
}を追加しないと構文エラーになるような場合には}の追加が試される。
</p>

<h3>インデントルールのなかの明示的な{}</h3>

<p>
明示的な{}でかこまれた内部では外側のインデントルールは適用されない。
</p>

<h2>仕様</h2>

<h3>前処理</h3>

<p>
以下のようにしてトークン{n}と&lt;n&gt;を追加する。
</p>

<ul>
<li>let, where, do, ofのあとに{が続かないとき
	<ul>
	<li>次の語があればそのインデントをnとして{n}を</li>
	<li>ファイルの終わりであれば{0}を</li>
	</ul></li>
<li>ファイルの先頭がキーワードmoduleでも{でもないとき
	<ul>
	<li>先頭に{n}を</li>
	</ul></li>
<li>行のなかで語の前に空白以外ないとき
	<ul>
	<li>その語の前にそのインデントをnとして&lt;n&gt;を</li>
	</ul></li>
</ul>

<p>
それぞれ追加する。
タブは8タブとして扱う。
1文字目から始まる語のインデントを1として考える。0ではない。
</p>

<h3>関数L</h3>

<p>前処理後のトークン列に対して以下のような関数Lを適用する。</p>

<p>
<a href="/computer/haskell/web_lecture/for_programmer/ifthenelse.html"
	>「構文: if式」へもどる</a>
<a href="/computer/haskell/web_lecture/for_programmer/whats_rec_fun.html"
	>「再帰関数とは」へ</a>
</p>
