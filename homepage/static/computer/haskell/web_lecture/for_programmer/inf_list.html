無限リスト

<h2>はじめに</h2>

<p>
「遅延性」という言葉がある。
使っているのは、僕の知っているかぎりでは、僕だけのようだ。
「遅延評価」と「遅延データ構造」をひっくるめて「遅延性」と呼んでいる。
そして、「遅延データ構造」の一例として「遅延リスト」がある。
</p>

<p>
無限リストは、遅延性を活用したデータ構造の典型である。
遅延性のおかげでHaskellでは「まず無限の長さのリストを作成し...」といった
コーディングが可能となる。
</p>

<h3>終了条件を分離</h3>

<p>
多くのアルゴリズムにおいて、終了条件というものは非本質的な部分である。
たとえば「大きい方から100個の素数を求める」といった場合、
従来の言語で普通にコーディングする場合、「100個で終了」という
コードは「素数を求める」というアルゴリズムとからみあい分離しがたい。
しかし、Haskellの遅延性を生かした無限リストを使うと、
「まずはすべての素数から成るリストを作成し、そこから100個取る」
ことが可能となる。
これにより本質的な部分(素数を求める)から
非本質的な部分(小さい方から100個取る)を分離することができる。
</p>

<!--
<h3>言葉の使いかたについて</h3>

<p>
ここらへんは初心者にはどうでもいいことなのかもしれないが、
一応触れておく。
</p>

<p>
遅延評価という言葉を遅延リストに使うのが良いことなのか悪いことなのか。
遅延リストと遅延評価とはあまり関係がない。別々の概念だ。
ただし類似しているところもあるし、また「遅延評価」という言葉はキャッチーだ。
</p>

<p>
遅延リストというものはHaskellでは「弱頭部正規形までの簡約」の一例である。
しかし「弱頭部正規形までの簡約」という言葉は初心者受けは悪そうだ。
そこで、「遅延評価」と「弱解部正規形までの簡約」をまとめて、
とりあえず、「遅延性」と呼んでおくことにする。
</p>
-->

<h2>1番小さな因数</h2>

<p><a href="/computer/haskell/web_lecture/for_programmer/12_inf_list/factor.hs"
	>factor.hs</a></p>

<p>
無限リストの例としてある自然数の最小の因数を求める関数を作成しよう。
再帰関数や再帰的定義を学ぶと、もっと面白い例が作れるので、
今回は簡単な例で我慢していただきたい。
</p>

<h3>考えかた</h3>

<p>
素朴な実装とする。
2から順に割っていき、余りが0になるものを探せば良い。
そのためには2以上の整数の列を作成する必要がある。
無限リストの例なので2以上の「すべての」整数を含むリストを作成することにしよう。
2以上のすべての整数を含むリストは以下のように作成できる。
</p>

<code>[2 ..]</code>

<p>
ある数nをこれで割った余りが0になるものだけを集めたリストを作成する。
関数filterを使えば良い。
</p>

<code>filter ((== 0) . (n `mod`)) [2 ..]</code>

<p>「最小の」因数なので1番先頭を取る。</p>

<code>head $ filter ((== 0) . (n `mod`)) [2 ..]</code>

<p>
nが2より小さい場合、この関数は無限に実行されてしまう。
これを避けるためにガードでふるい分けをする。
</p>

<pre><code>factor n
	| n &lt; 2 = 1
	| otherwise = head $ filter
		((== 0) . (n `mod`)) [2 ..]</code></pre>

<p>試してみよう。</p>

<code>% ghci factor.hs<br/>
*Main&gt; factor 221<br/>
13<br/>
*Main&gt; factor 100233223200127<br/>
9997777</code>

<h2>平方数のリスト</h2>

<p>
今度は平方数のリストを見てみよう。
平方数のリストは以下のように作ることができる。
</p>

<p><a href="/computer/haskell/web_lecture/for_programmer/12_inf_list/squares.hs"
	>squares.hs</a></p>

<pre><code>squares :: [Integer]
squares = map (^ 2) [0 ..]</code></pre>

<p>試してみる。</p>

<code>ghci squares.hs<br/>
*Main&gt; take 13 squares
[0,1,4,9,16,25,36,49,64,81,100,121,144]</code>

<p>
takeは指定した数だけリストから値を取り出す関数。
無限リストを表示するときにはtakeを使わないと無限実行となってしまう。
</p>

<p>
<a href="/computer/haskell/web_lecture/for_programmer/list_as_data.html"
	>「データ構造としてのリスト」へもどる</a>
<a href="/computer/haskell/web_lecture/for_programmer/about_montecarlo.html"
	>「モンテカルロ法の説明」へ</a>
</p>
