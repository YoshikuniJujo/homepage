モジュールStmFile.hsを作る

<h2>モジュールの目的</h2>

<p>
STM(ソフトウェアトランザクショナルメモリ)の考えかたを応用して、
ファイルを複数のスレッドから編集する。
</p>

<h2>基本的な流れ</h2>

<ol>
<li>そのスレッドに個有のディレクトリを作成する</li>
<li>ファイルを読み込む</li>
<li>ハッシュ値を計算して個有のディレクトリに保存する</li>
<li>更新作業を行いその結果を固有のディレクトリに保存する</li>
<li>ロックを取得する</li>
<li>ファイルを読み込み、ハッシュ値を計算する</li>
<li>保存しておいたハッシュ値と比較する</li>
<li>同じだったら
	<ol>
	<li>仮のファイルをリネームし、もとのファイルを上書き</li>
	<li>ディレクトリを削除し終了</li>
	</ol>
<li>2にもどる</li>
</ol>

<h2>決定すべき事項</h2>

<h3>ディレクトリ名</h3>

<p>
もとのファイルの'.'を'_'に変えた文字列にthread IDをくっつけたものとする。
</p>

<h3>ハッシュ関数</h3>

<p>
この程度の用途であれば何でも良いとは思うが、一応SHA 256あたりにする。
</p>

<h3>ロックのアルゴリズム</h3>

<h4>STMを使用したロック</h4>

<p>
ロックには<a href="https://hackage.haskell.org/package/stm-2.4.3/docs/Control-Concurrent-STM.html">STM</a>を使用することにする。
ロックは値がUnlockになるまでretryし、UnlockになったらLockにして次の処理へ。
アンロックは単に値をUnlockにすれば良い。
</p>

<h4>ディレクトリの作成を使用したロック</h4>

<p>
上の方法は「同一プロセス内の複数のスレッド」でなら使えるが、
「複数のプロセス」の場合は使えない。
この場合にはディレクトリの作成を使用したロックが必要になる。
</p>
