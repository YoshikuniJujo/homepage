仲裁更新の問題

<h2>木の実の数</h2>

<p>
拾ってきた木の実の数の総計を記録しようとしている。
今、この記録がたとえば23だったとしよう。
ここでAさんは8個の木の実を拾ってきた。
Bさんは12個の木の実を拾ってきた。
結果として、記録は43になるはずである。
</p>

<p>
しかし、以下のような場合を考えてみよう。
</p>

<ol>
<li>Aさんが記録を見て「現在の木の実の個数」を調べる</li>
<li>木の実の個数は23である</li>
<li>Aさんは23に8を足して31を記録しようとする</li>
<li>31を記録する前にBさんが「現在の木の実の個数」を調べる</li>
<li>木の実の個数の記録はまだ23である</li>
<li>Bさんは23に12を足して35を記録しようとする</li>
<li>Aさんが実際に31を記録する</li>
<li>Bさんが実際に35を記録する</li>
</ol>

<p>
結果として木の実の個数は35として記録されてしまう。
</p>

<h2>Aさんのしたこと</h2>

<p>
一連の流れのなかでAさんは、記録を調べ、それに8を足して、
それを記録している。
</p>

<h2>Bさんのしたこと</h2>

<p>
同様にBさんも、記録を調べ、それに12を足して、それを記録している。
</p>

<h2>何が問題だったのか</h2>

<p>
Aさんとしても、Bさんとしても、自分が何かまちがえたことをしたとは思っていない。
しかし、それでも結果は誤りとなる。
</p>

<p>
問題は2人の行った操作がまざりあってしまったことである。
「記録を読み、足し算し、記録に書き込む」という一連の流れは、
途中に他の操作をはさんではならない。
つまり、アトミックな操作でなければならないということだ。
</p>

<h2>解決</h2>

<ul>
<li><a href="/computer/programming/algorithm/lock">ロックによる解決</a></li>
<li><a href="/computer/programming/algorithm/stm">STMによる解決</a></li>
</ul>
