PEG: Parsing Expression Grammer

<p><a href="http://ja.wikipedia.org/wiki/Parsing_Expression_Grammar"
	>ウィキペディアのPEGの説明</a></p>

<h2>バッカス・ナウア記法との違い</h2>

<p>
<a href="/computer/programming/algorithm/parse/cfg.html"
>文脈自由文法の説明</a>のバッカス・ナウア記法(BNF)を参照。
PEG文法はこのバッカス・ナウア記法の'|'(選択)を'/'(試行)に変えたものと言える。
また'&amp;'や'!'による「先読み」も追加されている。
</p>

<h3>選択と試行の違い</h3>

<p>
「選択」では'|'の左右の両方の可能性があるのに対して、
「試行」では'/'の左側から順に試していって失敗した場合のみ次の規則を試す。
つまり、PEGでは入力列は常にただひとつのやりかたで解釈され、
曖昧性を持たない。
</p>

<p>
これは'/'で区切られたひとまとまりの表現を越えてバックトラックすることは
ないということだ。
たとえば(a b c / a b) cのような文法があった場合、
入力"abc"は選択の左側にマッチするがその後にcが来ないので全体としては失敗する。
このとき文脈自由文法では選択をやり直す(バックトラックする)ことで再度マッチを
試みるが、PEGではそのようなやり直し(バックトラック)は行わないということである。
</p>

<h3>先読み</h3>

<p>
入力を消費せずに、あるいは入力列のなかでの位置を変えずに、
入力が文法的に正しいかどうかをチェックするのが先読みである。
肯定先読み(&amp;)と否定先読み(!)とがある。
</p>

<p>
例えば"abc"から始まるもの以外のa, b, cから成る任意の列は以下のように表現できる。
</p>

<pre><code>NABC = !('a' 'b' 'c') ('a' | 'b' | 'c')*</code></pre>

<p>
先読みができるので(文脈自由文法の範囲外の)文脈依存文法の一部をパースすることができる
(文脈依存文法については後々書く予定)。
有名な例としてはa, b, cがこの順に同じ数だけ並ぶという文法がある。
</p>

<pre><code>S &lt;- &amp;(A !b) a+ B !c
A &lt;- a A? b
B &lt;- b B? c
</code></pre>

<p>
簡単に解説すると以下のようになる。
Sの定義の&amp;による先読みのなかで、
Aを満たししかもすべてのbを消費したことを確認する。
Aを満たすということはaとbが同数並んでいるということ。
Aを満たすということが確認された時点でもうaは不要なので、
a+でaをすべて消費しておく。
そのあと、Bを満たししかもcをすべて消費したことを確認している。
</p>

<h2>PEGの表現できる文法の範囲</h2>

<p>
PEGというものは新しい技術であり、また、おそらく実用主導で作られたため、
十分な研究が進んでいないと思われる。
よってPEG文法の表現できる範囲については明らかではない。
文脈自由文法の大部分とそれを越える文脈依存文法の一部といったところではないか、
と言われている。
文脈自由文法のなかでPEGで表現できないものがあるかどうかについては、
未解決な問題らしい。
たとえば回文のパースはPEGではできないのではないかと考えられている。
</p>

<h3>左再帰は許されない</h3>

<p>
左再帰を使うことでより自然な形で表現できる文法というものがある。
しかし、PEGでは左再帰を扱うことができない。
以下のような文法を考えてみる。
</p>

<pre><code>A = A 'a' / 'a'</code></pre>

<p>
これは'a'が連続並びを意図した文法だが、これは動作しない。
たとえば"aaa"をこの文法で解析しようとする。
まずはA 'a'の左側のAを見る。
すると、"aaa"をAで解析する必要があることがわかる。
再度A 'a'の左側のAを見る。
すると、やはり"aaa"をAで解析する必要がある。
これは無限ループとなる。
</p>

<p>
左側の規則が失敗することを確かめるまでは右の規則に進めないところに問題の本質がある
と思われる。
</p>

<h3>左再帰は右再帰に変換する</h3>

<p>
すべての左再帰は右再帰に変換することが可能だ。
出来上がる構文樹は適宜修正してやる必要がある。
</p>

<h2>PEGの何がすごいのか</h2>

<p>
PEGは理論主導ではなく実用主導で作られてきたと思われる。
PEGのすごさはパックラット構文解析という手法ぬきでは話ることができない。
PEGを素直に実装した場合、最悪の場合、指数関数時間がかかる。
しかし、解析の途中を記録しておくことで、解析を線形時間で行うことができる。
このようなメモ化を行う構文解析の手法をパックラット構文解析と呼ぶ。
</p>

<p>
パックラット構文解析については後でまとめる予定だ。
</p>

<p>
PEGのすごさは文脈自由文法の範囲内の多くの部分と、
それを越える文脈依存文法の範囲内の一部を線形時間で解析可能ということだ。
また、その表記が直観的で、人間にとってわかりやすいということも利点のひとつだろう。
</p>

<p>
<a href="/computer/programming/algorithm/parse">「構文解析」トップへもどる</a>
</p>
